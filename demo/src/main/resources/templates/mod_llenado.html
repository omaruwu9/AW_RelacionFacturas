<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modulo de Llenado - Promex</title>
    <style>
        body {
            background-color: #121212;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #1f1f1f;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header img {
            height: 60px;
        }

        #botones button {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #botones button:hover {
            background-color: #cc0000;
        }

        .main-content {
            padding: 40px;
            flex: 1;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .filtros {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .filtros input {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background-color: #2c2c2c;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #1e1e1e;
            color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background-color: #ff0000;
        }

        th, td {
            padding: 12px;
            text-align: center;
        }

        tbody tr:hover {
            background-color: #2a2a2a;
            cursor: pointer;
        }

        footer {
            background-color: #1f1f1f;
            color: white;
            text-align: center;
            padding: 15px 0;
        }
    </style>
</head>
<body>
<header>
    <img src="/images/promex-logo.png" alt="Promex Logo">
    <div id="botones">
        <button onclick="location.href='/dashboard'">Inicio</button>
        <button onclick="location.href='/logout'">Cerrar Sesión</button>
    </div>
</header>

<div class="main-content">
    <h2>Órdenes de Compra</h2>

    <div class="filtros">
        <input type="text" id="filtroSolicitud" placeholder="Buscar Solicitud OC">
        <input type="text" id="filtroOrden" placeholder="Buscar Orden Compra">
        <input type="text" id="filtroCentro" placeholder="Buscar Centro de Costos">
        <input type="date" id="filtroFecha">
    </div>

    <table>
        <thead>
        <tr>
            <th>Solicitud OC</th>
            <th>Fecha Requerida</th>
            <th>Orden Compra</th>
            <th>Fecha OC</th>
            <th>Centro de Costos</th>
            <th>Cuenta Contable</th>
            <th>Descripción</th>
            <th>Proveedor</th>
            <th>Estado</th>
        </tr>
        </thead>
        <tbody id="tablaBody"></tbody>
    </table>
</div>

<footer>
    &copy; 2025 Promex Logistics S. de R.L. de C.V. Todos los derechos reservados.
</footer>

<script>
    function filtrarFilas(data) {
        const solicitud = document.getElementById("filtroSolicitud").value.toLowerCase();
        const orden = document.getElementById("filtroOrden").value.toLowerCase();
        const centro = document.getElementById("filtroCentro").value.toLowerCase();
        const fecha = document.getElementById("filtroFecha").value;

        return data.filter(item => {
            return (!solicitud || item.solicitudOc.toLowerCase().includes(solicitud)) &&
                (!orden || item.ordenCompra.toLowerCase().includes(orden)) &&
                (!centro || item.centroCosto.toLowerCase().includes(centro)) &&
                (!fecha || item.fechaRequerida?.substring(0, 10) === fecha);
        });
    }

    function cargarTabla(data) {
        const tbody = document.getElementById("tablaBody");
        tbody.innerHTML = "";
        data.forEach(item => {
            const tr = document.createElement("tr");
            tr.onclick = () => window.location.href = `/llenado/${item.id}`;
            tr.innerHTML = `
                <td>${item.solicitudOc}</td>
                <td>${item.fechaRequerida ? new Date(item.fechaRequerida).toLocaleDateString() : ''}</td>
                <td>${item.ordenCompra}</td>
                <td>${item.fecha ? new Date(item.fecha).toLocaleDateString() : ''}</td>
                <td>${item.centroCosto}</td>
                <td>${item.cuentaContable}</td>
                <td>${item.descCuentaContable}</td>
                <td>${item.nombreProveedor}</td>
                <td>${item.estado}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        let dataGlobal = [];
        fetch('/api/ordenes-compra')
            .then(response => response.json())
            .then(data => {
                dataGlobal = data;
                cargarTabla(data);

                document.querySelectorAll('.filtros input').forEach(input => {
                    input.addEventListener('input', () => {
                        const filtrados = filtrarFilas(dataGlobal);
                        cargarTabla(filtrados);
                    });
                });
            })
            .catch(error => console.error("Error al obtener las órdenes de compra:", error));
    });
</script>
</body>
</html>
